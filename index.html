<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
      .img_cont img, .img_cont_msg img { width: 40px; height: 40px; object-fit: cover; border-radius: 50%; }
      .chat { margin-top: auto; margin-bottom: auto; }
      .card { height: 600px; border-radius: 15px; background-color: rgb(240, 234, 234); }
      .card-header { border-radius: 15px 15px 0 0; color: rgb(14, 13, 13); }
      .msg_card_body { overflow-y: auto; height: 400px; }
      .type_msg { background: white; border: none; color: white; height: 60px; }
      .send_btn { background: #5947fa; color: white; border-radius: 0 15px 15px 0; }
      .msg_cotainer_send, .msg_cotainer { padding: 10px; border-radius: 10px; max-width: 300px; }
      .msg_cotainer_send { background: #5947fa; color: white; margin-right: 15px; }
      .msg_cotainer { background: #08ad16; color: white; margin-left: 10px; }
      .msg_time_outside { font-size: 0.8em; color: black; margin-top: 2px; }
    </style>
  </head>

  <body>
    <div class="container-fluid h-100">
      <div class="row justify-content-center h-100">
        <div class="col-md-8 col-xl-6 chat">
          <div class="card">
            <div class="card-header d-flex bd-highlight">
              <div class="img_cont">
                <img src="{{ url_for('static', filename='logotruong.png') }}" />
              </div>
              <div class="user_info"><span>ChatBotNLU</span><p>Tiểu luận nhóm 10</p></div>
            </div>
            <div id="messageFormeight" class="card-body msg_card_body"></div>
            <div class="card-footer">
              <form id="messageArea" class="input-group">
                <input type="text" id="text" placeholder="Type your message..." class="form-control type_msg" required />
                <div class="input-group-append">
                  <button type="submit" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const appendMessage = (message, type) => {
        const time = new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
        const align = type === "send" ? "end" : "start";
        const className = type === "send" ? "msg_cotainer_send" : "msg_cotainer";
        const html = `
          <div class="d-flex justify-content-${align} mb-2">
            <div class="${className}">${message}</div>
          </div>
          <div class="d-flex justify-content-${align} mb-2">
            <span class="msg_time_outside">${time}</span>
          </div>`;
        $("#messageFormeight").append(html).scrollTop($("#messageFormeight")[0].scrollHeight);
      };

      $("#messageArea").on("submit", function (e) {
        e.preventDefault();
        const userText = $("#text").val();
        appendMessage(userText, "send");
        $("#text").val("");
        $.post("/get", { msg: userText }, (data) => appendMessage(data, "receive"));
      });
    </script>
  </body>
</html>
